define(["jquery","core/ajax","core/templates","core/notification"],function(i,n,r,s){function c(e){n.call([{methodname:"tool_supporter_get_assignable_roles",args:{courseID:e}}],!0,!0)[0].done(function(e){r.render("tool_supporter/enrolusersection",e).done(function(e,o){i('[data-region="enroluserregion"]').replaceWith(e),i('[data-region="enroluserregion"]').show(),r.runTemplateJS(o)}).fail(s.exception)}).fail(s.exception)}function e(){n.call([{methodname:"tool_supporter_toggle_course_visibility",args:{courseID:i("#selectedcourseid")[0].textContent}}],!0,!0)[0].done(function(e){r.render("tool_supporter/course_detail",e).done(function(e,o){i('[data-region="course_details"]').replaceWith(e),i('[data-region="course_details"]').show(),r.runTemplateJS(o)}).fail(s.exception)}).fail(s.exception)}return{showCourseDetail:function(t,e){"undefined"===e&&(e=0);var o=i("#course_details").offset().top,o=(i("html, body").animate({scrollTop:o-50},"slow"),n.call([{methodname:"tool_supporter_get_course_info",args:{courseID:t}}]));return o[0].done(function(e){r.render("tool_supporter/course_detail",e).done(function(e,o){i('[data-region="course_details"]').replaceWith(e),i('[data-region="course_details"]').show(),r.runTemplateJS(o),1===i("#selecteduserid").length&&c(t)}).fail(s.exception)}).fail(s.exception),e?o:null},toggleCourseVisibility:function(){i("#hide_course_visibility").on("click",function(){e()}),i("#show_course_visibility").on("click",function(){e()})},toggleUserDetails:function(){i("#btn_hide_user_details, #btn_show_user_details").on("click",function(){i("#user_details_body").toggle(),i("#btn_hide_user_details").toggle(),i("#btn_show_user_details").toggle()})},toggleCourseDetails:function(){i("#btn_hide_course_details, #btn_show_course_details").on("click",function(){i("#course_details_body").toggle(),i("#btn_hide_course_details").toggle(),i("#btn_show_course_details").toggle()})},clickOnUser:function(t){i(t+" tbody").on("click","tr",function(){var e,o=i(this).find("td:first-child").text();isNaN(o)||(e=i(t).dataTable()[0],i(e.rows).css("background-color",""),i(this).css("background-color","#bcbcbc"),e=i("#user_details").offset().top,i("html, body").animate({scrollTop:e-50},"slow"),n.call([{methodname:"tool_supporter_get_user_information",args:{userid:o}}])[0].done(function(e){r.render("tool_supporter/user_detail",e[0]).done(function(e,o){i('[data-region="user_details"]').replaceWith(e),i('[data-region="user_details"]').show(),i('[data-region="course_details"]').is(":visible")&&(e=i("#selectedcourseid")[0].textContent,c(e)),r.runTemplateJS(o)}).fail(s.exception)}).fail(s.exception))})},clickOnCourse:function(t){var n=this;i(t+" tbody").on("click","tr",function(){var e,o=i(this).find("td:first-child").text();isNaN(o)||(e=i(t).dataTable()[0],i(e.rows).css("background-color",""),i(this).css("background-color","#bcbcbc"),n.showCourseDetail(o,!1))})},clickOnRefresh:function(e,o,t){i("#btn_refresh_users").on("click",function(){n.call([{methodname:o,args:t}])[0].done(function(e){r.render("tool_supporter/user_table",e).done(function(e,o){i('[data-region="user_table"]').replaceWith(e),r.runTemplateJS(o)}).fail(s.exception)}).fail(s.exception)}),i("#btn_refresh_courses").on("click",function(){n.call([{methodname:o,args:t}])[0].done(function(e){r.render("tool_supporter/course_table",e).done(function(e,o){i('[data-region="course_table"]').replaceWith(e),r.runTemplateJS(o)}).fail(s.exception)}).fail(s.exception)})}}});